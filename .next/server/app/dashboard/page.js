(()=>{var e={};e.id=702,e.ids=[702],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},5036:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>p,tree:()=>c});var s=r(7096),a=r(6132),n=r(7284),i=r.n(n),l=r(2564),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c=["",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,1618)),"C:\\Users\\DAVID\\OneDrive\\Documentos\\barber-platform\\app\\dashboard\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,2834)),"C:\\Users\\DAVID\\OneDrive\\Documentos\\barber-platform\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\DAVID\\OneDrive\\Documentos\\barber-platform\\app\\dashboard\\page.tsx"],x="/dashboard/page",m={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/page",pathname:"/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},348:(e,t,r)=>{Promise.resolve().then(r.bind(r,2948))},2948:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>DashboardPage});var s=r(784),a=r(9885),n=r(3334),i=r(7114),l=r(1440),o=r.n(l),c=r(859),d=r(4560),x=r(8699);function AppointmentCard({appointment:e,role:t}){let[r,l]=(0,a.useState)(!1),o=(0,i.useRouter)(),m=(0,n.createClientComponentClient)(),handleCancel=async()=>{if(!confirm("\xbfEst\xe1s seguro de que quieres cancelar esta cita?"))return;l(!0);let{error:t}=await m.from("citas").update({estado:"cancelada"}).eq("id",e.id);t?(alert("Error al cancelar: "+t.message),l(!1)):o.refresh()},handleMarkAsCompleted=async()=>{if(!confirm("\xbfMarcar esta cita como completada?"))return;l(!0);let{error:t}=await m.from("citas").update({estado:"completada"}).eq("id",e.id);t?(alert("Error al actualizar: "+t.message),l(!1)):o.refresh()};"cliente"===t?e.perfiles_barbero:e.perfiles_cliente;let p=e.cliente_nombre||e.perfiles_cliente?.nombre||"Cliente",u=e.perfiles_barbero?.nombre||"Barbero",h="admin"===t?`${p} con ${u}`:"cliente"===t?u:p;return(0,s.jsxs)("div",{className:"bg-white border border-zinc-100 rounded-[1.5rem] p-6 shadow-sm hover:shadow-lg hover:border-navy-900/10 transition-all duration-300 group",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,s.jsxs)("div",{children:[s.jsx("span",{className:(0,x.cn)("text-[10px] font-bold px-2.5 py-1 rounded-full border uppercase tracking-widest",{pendiente:"bg-amber-100 text-amber-700 border-amber-200",confirmada:"bg-green-100 text-green-700 border-green-200",cancelada:"bg-red-50 text-red-600 border-red-100",completada:"bg-zinc-100 text-zinc-500 border-zinc-200"}[e.estado]||"bg-gray-100 text-gray-500"),children:e.estado}),s.jsx("h3",{className:"text-navy-900 font-bold text-lg mt-3 group-hover:text-blue-600 transition-colors",children:e.servicios?.nombre||"Servicio General"})]}),(0,s.jsxs)("div",{className:"text-right bg-zinc-50 rounded-xl px-3 py-2 border border-zinc-100",children:[s.jsx("p",{className:"text-xl font-bold text-navy-900 leading-none",children:(0,c.ZP)(new Date(e.fecha_hora),"d",{locale:d.es})}),s.jsx("p",{className:"text-zinc-400 uppercase text-[10px] font-bold tracking-wider leading-none mt-1",children:(0,c.ZP)(new Date(e.fecha_hora),"MMM",{locale:d.es})})]})]}),(0,s.jsxs)("div",{className:"space-y-3 text-sm text-zinc-500",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"w-8 h-8 rounded-full bg-zinc-50 flex items-center justify-center text-zinc-400",children:"\uD83D\uDD52"}),(0,s.jsxs)("span",{className:"font-medium",children:[(0,c.ZP)(new Date(e.fecha_hora),"h:mm a")," • ",e.servicios?.duracion_minutos," min"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"w-8 h-8 rounded-full bg-zinc-50 flex items-center justify-center text-zinc-400",children:"\uD83D\uDC64"}),(0,s.jsxs)("span",{children:[s.jsx("span",{className:"text-xs uppercase font-bold text-zinc-400 block mb-0.5",children:"cliente"===t?"Barbero":"Cliente"}),s.jsx("span",{className:"text-navy-900 font-bold text-base",children:h})]})]}),("barbero"===t||"admin"===t)&&(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"w-8 h-8 rounded-full bg-zinc-50 flex items-center justify-center text-zinc-400",children:"\uD83D\uDCDE"}),(0,s.jsxs)("span",{children:[s.jsx("span",{className:"text-xs uppercase font-bold text-zinc-400 block mb-0.5",children:"Tel\xe9fono"}),s.jsx("span",{className:"text-navy-900 font-bold text-base",children:e.cliente_telefono||e.perfiles_cliente?.telefono||"No registrado"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"w-8 h-8 rounded-full bg-zinc-50 flex items-center justify-center text-zinc-400",children:"\uD83D\uDCB0"}),(0,s.jsxs)("span",{className:"font-mono font-bold text-navy-900",children:["$",e.servicios?.precio.toLocaleString("es-CO")]})]})]}),("pendiente"===e.estado||"confirmada"===e.estado)&&(0,s.jsxs)("div",{className:"mt-6 pt-4 border-t border-zinc-50 space-y-2",children:[("barbero"===t||"admin"===t)&&s.jsx("button",{onClick:handleMarkAsCompleted,disabled:r,className:"w-full text-center text-sm bg-green-600 hover:bg-green-700 text-white font-bold transition-colors py-3 rounded-xl disabled:opacity-50",children:r?"⏳ Procesando...":"✓ Marcar como Listo"}),s.jsx("button",{onClick:handleCancel,disabled:r,className:"w-full text-center text-sm text-red-500 hover:text-red-600 font-bold transition-colors hover:bg-red-50 py-3 rounded-xl",children:r?"Cancelando...":"Cancelar Cita"})]})]})}function DashboardPage(){let[e,t]=(0,a.useState)([]),[r,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),x=(0,n.createClientComponentClient)(),m=(0,i.useRouter)(),p=(0,i.useSearchParams)(),u="success"===p.get("booking");(0,a.useEffect)(()=>{let checkUser=async()=>{let{data:{user:e}}=await x.auth.getUser();if(!e){m.push("/login");return}try{let{data:r}=await x.from("perfiles").select("*").eq("id",e.id).single();if(d(r),r){let s=x.from("citas").select(`
                            *,
                            servicios(*),
                            perfiles_barbero:perfiles!citas_barbero_id_fkey(*),
                            perfiles_cliente:perfiles!citas_cliente_id_fkey(*)
                        `).order("fecha_hora",{ascending:!0});"barbero"===r.rol?s=s.eq("barbero_id",e.id):"cliente"===r.rol&&(s=s.eq("cliente_id",e.id));let{data:a,error:n}=await s;a&&t(a),n&&console.error("Error fetching appointments:",n)}}catch(e){console.error("Error in checkUser:",e)}finally{l(!1)}};checkUser()},[x,m]);let handleLogout=async()=>{await x.auth.signOut(),m.push("/"),m.refresh()},h=(()=>{let t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),s=new Date(r);s.setDate(s.getDate()+1);let a=new Date(r);a.setDate(a.getDate()+7);let n={today:[],tomorrow:[],thisWeek:[],later:[]};return e.forEach(e=>{let t=new Date(e.fecha_hora),i=new Date(t.getFullYear(),t.getMonth(),t.getDate());i.getTime()===r.getTime()?n.today.push(e):i.getTime()===s.getTime()?n.tomorrow.push(e):i>s&&i<a?n.thisWeek.push(e):i>=a&&n.later.push(e)}),n})();if(r)return s.jsx("div",{className:"min-h-screen bg-[#F2F2F2] flex items-center justify-center font-outfit text-navy-900",children:"Cargando tu agenda..."});let b=c?.rol==="admin",g=c?.rol==="barbero";return s.jsx("main",{className:"min-h-screen bg-[#F2F2F2] text-navy-900 px-4 py-8 font-outfit",children:(0,s.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8",children:[s.jsx("div",{className:"flex flex-col gap-4",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center gap-6 bg-white p-8 rounded-[2rem] shadow-sm border border-white relative overflow-hidden",children:[s.jsx("button",{onClick:handleLogout,className:"absolute top-6 right-6 text-zinc-400 hover:text-red-500 transition-colors p-2 rounded-full hover:bg-red-50",title:"Cerrar Sesi\xf3n",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75"})})}),(0,s.jsxs)("div",{className:"text-center md:text-left pr-12",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 justify-center md:justify-start mb-2",children:[s.jsx("span",{className:"bg-navy-900 text-white w-10 h-10 flex items-center justify-center rounded-full text-lg font-bold shadow-md",children:c?.nombre?.[0]||"T"}),(0,s.jsxs)("h1",{className:"text-3xl font-bold text-navy-900 tracking-tight",children:["Hola, ",c?.nombre?.split(" ")[0]]})]}),(0,s.jsxs)("p",{className:"text-zinc-500 font-medium pl-14",children:["Bienvenido a tu panel de ",c?.rol==="admin"?"Administrador":c?.rol==="barbero"?"Barbero":"Cliente"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap justify-center gap-4 mt-2 md:mt-0",children:[(0,s.jsxs)(o(),{href:"/book",className:"bg-navy-900 text-white px-8 py-3.5 rounded-xl font-bold text-base transition-all duration-300 hover:bg-navy-800 hover:scale-105 shadow-lg flex items-center gap-2",children:[s.jsx("span",{children:"+"})," Nueva Cita"]}),b&&(0,s.jsxs)(o(),{href:"/admin/barbers",className:"bg-white text-navy-900 border border-zinc-200 px-8 py-3.5 rounded-xl font-bold text-base transition-all duration-300 hover:bg-zinc-50 hover:scale-105 shadow-sm flex items-center gap-2",children:[s.jsx("span",{children:"\uD83D\uDEE0️"})," Panel Admin"]}),(b||g)&&(0,s.jsxs)(o(),{href:"/admin/qr",className:"bg-slate-100 text-slate-600 px-6 py-3.5 rounded-xl font-bold text-base transition-all duration-300 hover:bg-slate-200 flex items-center gap-2",children:[s.jsx("span",{children:"\uD83D\uDCF1"})," QR"]}),(0,s.jsxs)(o(),{href:"/settings",className:"bg-white text-zinc-600 border border-zinc-200 px-6 py-3.5 rounded-xl font-bold text-base transition-all duration-300 hover:bg-zinc-50 flex items-center gap-2",children:[s.jsx("span",{children:"\uD83D\uDD11"})," Clave"]})]})]})}),u&&(0,s.jsxs)("div",{className:"bg-green-50 text-green-800 border border-green-200 rounded-2xl p-6 flex items-center gap-4 shadow-sm animate-in fade-in slide-in-from-top-4",children:[s.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-2xl",children:"\uD83C\uDF89"}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-bold text-lg",children:"\xa1Reserva confirmada con \xe9xito!"}),s.jsx("p",{className:"opacity-80",children:"Te hemos enviado un correo con los detalles."})]})]}),0===e.length?(0,s.jsxs)("div",{className:"text-center py-20 bg-white rounded-3xl border border-white shadow-sm",children:[s.jsx("div",{className:"text-5xl mb-4",children:"\uD83D\uDCC5"}),s.jsx("h3",{className:"text-xl font-bold text-navy-900 mb-2",children:"No tienes citas programadas"}),s.jsx("p",{className:"text-zinc-500 mb-6",children:"\xbfQu\xe9 tal un corte fresco para esta semana?"}),s.jsx(o(),{href:"/book",className:"text-navy-900 font-bold underline underline-offset-4 hover:text-navy-700",children:"Agendar mi primera cita"})]}):(0,s.jsxs)("div",{className:"space-y-10",children:[h.today.length>0&&(0,s.jsxs)("section",{children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2 text-navy-900",children:[s.jsx("span",{className:"bg-navy-50 text-navy-900 p-2 rounded-lg text-lg",children:"\uD83D\uDCC5"}),"Hoy"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.today.map(e=>s.jsx(AppointmentCard,{appointment:e,role:c?.rol||"cliente"},e.id))})]}),h.tomorrow.length>0&&(0,s.jsxs)("section",{children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2 text-navy-900",children:[s.jsx("span",{className:"bg-navy-50 text-navy-900 p-2 rounded-lg text-lg",children:"\uD83D\uDDD3️"}),"Ma\xf1ana"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.tomorrow.map(e=>s.jsx(AppointmentCard,{appointment:e,role:c?.rol||"cliente"},e.id))})]}),h.thisWeek.length>0&&(0,s.jsxs)("section",{children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2 text-navy-900",children:[s.jsx("span",{className:"bg-navy-50 text-navy-900 p-2 rounded-lg text-lg",children:"\uD83D\uDCC6"}),"Esta Semana"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.thisWeek.map(e=>s.jsx(AppointmentCard,{appointment:e,role:c?.rol||"cliente"},e.id))})]}),h.later.length>0&&(0,s.jsxs)("section",{children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2 text-navy-900",children:[s.jsx("span",{className:"bg-navy-50 text-navy-900 p-2 rounded-lg text-lg",children:"\uD83D\uDCCB"}),"Pr\xf3ximamente"]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:h.later.map(e=>s.jsx(AppointmentCard,{appointment:e,role:c?.rol||"cliente"},e.id))})]})]})]})})}},8699:(e,t,r)=>{"use strict";r.d(t,{cn:()=>cn});var s=r(566),a=r(8126);function cn(...e){return(0,a.m6)((0,s.W)(e))}},1618:(e,t,r)=>{"use strict";r.r(t),r.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>o});var s=r(5153);let a=(0,s.createProxy)(String.raw`C:\Users\DAVID\OneDrive\Documentos\barber-platform\app\dashboard\page.tsx`),{__esModule:n,$$typeof:i}=a,l=a.default,o=l},1440:(e,t,r)=>{e.exports=r(614)}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[657,126,614,334,410,859,560,9],()=>__webpack_exec__(5036));module.exports=r})();