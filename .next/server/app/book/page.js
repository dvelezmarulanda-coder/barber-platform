(()=>{var e={};e.id=886,e.ids=[886],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},5505:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>u,tree:()=>c});var a=r(7096),s=r(6132),i=r(7284),n=r.n(i),o=r(2564),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=["",{children:["book",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2120)),"C:\\Users\\DAVID\\OneDrive\\Documentos\\barber-platform\\app\\book\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,2834)),"C:\\Users\\DAVID\\OneDrive\\Documentos\\barber-platform\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\DAVID\\OneDrive\\Documentos\\barber-platform\\app\\book\\page.tsx"],x="/book/page",m={require:r,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/book/page",pathname:"/book",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3773:(e,t,r)=>{Promise.resolve().then(r.bind(r,1846)),Promise.resolve().then(r.t.bind(r,614,23))},1846:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>BookingWizard});var a=r(784),s=r(9885),i=r(3334),n=r(7114),o=r(8699);function ServiceSelection({onSelect:e,selectedServiceId:t}){let[r,n]=(0,s.useState)([]),[l,c]=(0,s.useState)(!0),d=(0,i.createClientComponentClient)();return((0,s.useEffect)(()=>{let fetchServices=async()=>{let{data:e,error:t}=await d.from("servicios").select("*").eq("activo",!0).order("precio",{ascending:!0});e&&n(e),c(!1)};fetchServices()},[d]),l)?a.jsx("div",{className:"text-navy-900 text-center py-8",children:"Cargando servicios disponibles..."}):(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("h3",{className:"text-xl font-bold text-navy-900 mb-4",children:"Selecciona tu servicio"}),0===r.length?a.jsx("div",{className:"text-center p-8 bg-zinc-50 rounded-xl border border-zinc-100",children:a.jsx("p",{className:"text-zinc-500",children:"No hay servicios disponibles."})}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(r=>(0,a.jsxs)("button",{onClick:()=>e(r),className:(0,o.cn)("p-6 rounded-2xl border text-left transition-all duration-300 group hover:shadow-md",t===r.id?"border-navy-900 bg-navy-900 text-white shadow-lg transform scale-[1.02]":"border-zinc-200 bg-white text-navy-900 hover:border-navy-900/30"),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[a.jsx("span",{className:"font-bold text-lg",children:r.nombre}),(0,a.jsxs)("span",{className:(0,o.cn)("font-mono text-lg font-bold px-3 py-1 rounded-lg",t===r.id?"bg-white/20 text-white":"bg-zinc-100 text-navy-900"),children:["$",r.precio.toLocaleString("es-CO")]})]}),a.jsx("p",{className:(0,o.cn)("text-sm mb-4 leading-relaxed",t===r.id?"text-zinc-300":"text-zinc-500"),children:r.descripcion||"Servicio de corte profesional."}),(0,a.jsxs)("div",{className:(0,o.cn)("text-xs font-bold uppercase tracking-wider flex items-center gap-2",t===r.id?"text-white/80":"text-navy-900/60"),children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),r.duracion_minutos," min de duraci\xf3n"]})]},r.id))})]})}function BarberSelection({onSelect:e,selectedBarberId:t}){let[r,n]=(0,s.useState)([]),[l,c]=(0,s.useState)(!0),d=(0,i.createClientComponentClient)();return((0,s.useEffect)(()=>{let fetchBarbers=async()=>{let{data:e,error:t}=await d.from("perfiles").select("*").eq("rol","barbero");e&&n(e),c(!1)};fetchBarbers()},[d]),l)?a.jsx("div",{className:"text-navy-900 text-center py-8",children:"Cargando profesionales..."}):(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("h3",{className:"text-xl font-bold text-navy-900 mb-4",children:"Elige tu profesional"}),0===r.length?a.jsx("div",{className:"text-center p-8 bg-zinc-50 rounded-xl border border-zinc-100",children:a.jsx("p",{className:"text-zinc-500",children:"No hay barberos disponibles en este momento."})}):(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("button",{onClick:()=>e({id:"any",nombre:"Cualquier Profesional",rol:"barbero",email:"",telefono:null}),className:(0,o.cn)("p-6 rounded-2xl border transition-all duration-300 flex flex-col items-center gap-4 group","any"===t?"border-navy-900 bg-navy-900 text-white shadow-lg scale-105":"border-zinc-200 bg-white text-navy-900 hover:border-navy-900/30 hover:shadow-md"),children:[a.jsx("div",{className:(0,o.cn)("w-20 h-20 rounded-full flex items-center justify-center text-3xl transition-colors","any"===t?"bg-white/20 text-white":"bg-zinc-100 text-navy-900 group-hover:bg-zinc-200"),children:"\uD83D\uDC88"}),(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("span",{className:"font-bold block text-lg",children:"Cualquiera"}),a.jsx("span",{className:(0,o.cn)("text-xs font-medium uppercase tracking-wider","any"===t?"text-white/70":"text-zinc-500"),children:"M\xe1xima Disponibilidad"})]})]}),r.map(r=>(0,a.jsxs)("button",{onClick:()=>e(r),className:(0,o.cn)("p-6 rounded-2xl border transition-all duration-300 flex flex-col items-center gap-4 group",t===r.id?"border-navy-900 bg-navy-900 text-white shadow-lg scale-105":"border-zinc-200 bg-white text-navy-900 hover:border-navy-900/30 hover:shadow-md"),children:[a.jsx("div",{className:(0,o.cn)("w-20 h-20 rounded-full flex items-center justify-center text-2xl font-bold uppercase transition-colors",t===r.id?"bg-white/20 text-white":"bg-zinc-100 text-navy-900 group-hover:bg-zinc-200"),children:r.nombre.substring(0,2)}),(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("span",{className:"font-bold block text-lg",children:r.nombre}),a.jsx("span",{className:(0,o.cn)("text-xs font-medium uppercase tracking-wider",t===r.id?"text-white/70":"text-zinc-500"),children:"Barbero"})]})]},r.id))]})]})}var l=r(859),c=r(8521),d=r(7073),x=r(1391),m=r(303);function DateTimePicker({barberId:e,serviceDuration:t,onSelect:r,selectedDate:n}){let[u,b]=(0,s.useState)((0,l.ZP)(new Date,"yyyy-MM-dd")),[h,p]=(0,s.useState)([]),[f,v]=(0,s.useState)(!1),g=(0,i.createClientComponentClient)();return(0,s.useEffect)(()=>{let fetchAvailability=async()=>{v(!0);let r=new Date(u+"T00:00:00"),a=r.getDay(),s=[];if("any"===e){let{data:e}=await g.from("perfiles").select("id").eq("rol","barbero");e&&(s=e.map(e=>e.id))}else s=[e];if(0===s.length){p([]),v(!1);return}let{data:i}=await g.from("horarios_disponibilidad").select("*").in("barbero_id",s).eq("dia_semana",a).eq("activo",!0),n=i||[];if(!n||0===n.length){p([]),v(!1);return}let o=`${u}T00:00:00`,b=`${u}T23:59:59`,{data:h}=await g.from("citas").select("fecha_hora, servicio_id, barbero_id, servicios(duracion_minutos)").in("barbero_id",s).gte("fecha_hora",o).lte("fecha_hora",b).neq("estado","cancelada"),f=h||[],y=new Set;n.forEach(e=>{let[a,s]=e.hora_inicio.split(":").map(Number),[i,n]=e.hora_fin.split(":").map(Number),o=(0,m.Z)((0,x.Z)(r,a),s),b=(0,m.Z)((0,x.Z)(r,i),n),h=new Date;for(u===(0,l.ZP)(h,"yyyy-MM-dd")&&o<h&&(o=(0,c.Z)(h,30-h.getMinutes()%30));(0,d.Z)((0,c.Z)(o,t),b);){let r=(0,c.Z)(o,t),a=!1,s=f.filter(t=>t.barbero_id===e.barbero_id);for(let e of s){let t=new Date(e.fecha_hora),s=e.servicios?.duracion_minutos||30,i=(0,c.Z)(t,s);if(o>=t&&o<i||r>t&&r<=i||o<=t&&r>=i){a=!0;break}}a||y.add(o.getTime()),o=(0,c.Z)(o,30)}});let j=Array.from(y).sort((e,t)=>e-t).map(e=>({start:new Date(e),end:(0,c.Z)(new Date(e),t),available:!0}));p(j),v(!1)};e&&u&&fetchAvailability()},[e,u,t,g]),(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("h3",{className:"text-xl font-bold text-navy-900 mb-4",children:"\xbfCu\xe1ndo te gustar\xeda venir?"}),(0,a.jsxs)("div",{className:"bg-zinc-50 p-4 rounded-2xl border border-zinc-200",children:[a.jsx("label",{className:"block text-sm font-bold text-navy-900 mb-2 uppercase tracking-wide",children:"Fecha"}),a.jsx("input",{type:"date",value:u,min:(0,l.ZP)(new Date,"yyyy-MM-dd"),onChange:e=>b(e.target.value),className:"w-full p-3 rounded-xl bg-white border border-zinc-200 text-navy-900 focus:border-navy-900 focus:ring-1 focus:ring-navy-900 outline-none font-outfit text-lg"})]}),f?a.jsx("div",{className:"text-center text-navy-900 py-8 animate-pulse",children:"Buscando espacios disponibles..."}):0===h.length?a.jsx("div",{className:"text-center text-zinc-500 py-8 bg-zinc-50 rounded-xl border border-zinc-200",children:"No hay horarios disponibles para esta fecha."}):a.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-3",children:h.map((e,t)=>a.jsx("button",{disabled:!e.available,onClick:()=>r(e.start),className:(0,o.cn)("py-3 px-2 rounded-xl text-sm font-bold transition-all shadow-sm",!e.available&&"opacity-40 cursor-not-allowed bg-zinc-100 text-zinc-400 border border-zinc-200",e.available&&n?.getTime()===e.start.getTime()?"bg-navy-900 text-white shadow-lg scale-105":e.available&&"bg-white text-navy-900 border border-zinc-200 hover:border-navy-900 hover:bg-navy-50"),children:(0,l.ZP)(e.start,"HH:mm")},t))})]})}var u=r(4560);function BookingSummary({service:e,barber:t,date:r,onConfirm:s,loading:i}){return(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Resumen de tu Reserva"}),(0,a.jsxs)("div",{className:"bg-zinc-900 rounded-2xl p-6 space-y-4 border border-zinc-800",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center pb-4 border-b border-zinc-800",children:[a.jsx("span",{className:"text-zinc-400",children:"Servicio"}),(0,a.jsxs)("span",{className:"font-bold text-white text-right",children:[e.nombre,a.jsx("br",{}),(0,a.jsxs)("span",{className:"text-sm font-normal text-zinc-500",children:["$",e.precio," • ",e.duracion_minutos," min"]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center pb-4 border-b border-zinc-800",children:[a.jsx("span",{className:"text-zinc-400",children:"Barbero"}),a.jsx("span",{className:"font-bold text-white",children:t.nombre})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-zinc-400",children:"Fecha y Hora"}),(0,a.jsxs)("span",{className:"font-bold text-white text-right capitalize",children:[(0,l.ZP)(r,"EEEE d 'de' MMMM",{locale:u.es}),a.jsx("br",{}),(0,l.ZP)(r,"HH:mm")]})]})]}),a.jsx("button",{onClick:s,disabled:i,className:"w-full py-4 rounded-full bg-navy-900 text-white font-bold text-lg hover:bg-navy-800 transition-all duration-300 hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Confirmando...":"Confirmar Reserva"})]})}function GuestForm({onChange:e,defaultValues:t}){return(0,a.jsxs)("div",{className:"space-y-4 max-w-md mx-auto",children:[a.jsx("h3",{className:"text-xl font-semibold text-white",children:"Tus Datos"}),a.jsx("p",{className:"text-zinc-400 text-sm",children:"Ingresa tu informaci\xf3n para confirmar la cita."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-zinc-400 mb-1",children:"Nombre Completo *"}),a.jsx("input",{type:"text",required:!0,value:t.nombre,onChange:r=>e({...t,nombre:r.target.value}),className:"w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white focus:border-white outline-none",placeholder:"Ej. Juan P\xe9rez"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-zinc-400 mb-1",children:"Tel\xe9fono (Celular) *"}),a.jsx("input",{type:"tel",required:!0,value:t.telefono,onChange:r=>e({...t,telefono:r.target.value}),className:"w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white focus:border-white outline-none",placeholder:"Ej. 300 123 4567"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-sm text-zinc-400 mb-1",children:"Correo Electr\xf3nico (Opcional)"}),a.jsx("input",{type:"email",value:t.email,onChange:r=>e({...t,email:r.target.value}),className:"w-full bg-zinc-900 border border-zinc-800 rounded-lg p-3 text-white focus:border-white outline-none",placeholder:"Ej. juan@ejemplo.com"}),a.jsx("p",{className:"text-xs text-zinc-500 mt-1",children:"Te enviaremos el recordatorio a este correo."})]})]})]})}function BookingWizard(){let[e,t]=(0,s.useState)(1),[r,d]=(0,s.useState)(null),[x,m]=(0,s.useState)(null),[u,b]=(0,s.useState)(void 0),[h,p]=(0,s.useState)(!1),[f,v]=(0,s.useState)(null),[g,y]=(0,s.useState)({nombre:"",telefono:"",email:""}),j=(0,i.createClientComponentClient)(),w=(0,n.useRouter)();(0,s.useEffect)(()=>{let checkUser=async()=>{let{data:{user:e}}=await j.auth.getUser();v(e)};checkUser()},[j]);let handleConfirm=async()=>{if(!r||!x||!u)return;if(!f&&(!g.nombre||!g.telefono)){alert("Por favor completa tu nombre y tel\xe9fono");return}p(!0);let e=x.id;if("any"===e)try{let t=u.getDay(),{data:a}=await j.from("horarios_disponibilidad").select("barbero_id, hora_inicio, hora_fin").eq("dia_semana",t).eq("activo",!0);if(!a||0===a.length)throw Error("No hay barberos trabajando este d\xeda.");let s=(0,l.ZP)(u,"HH:mm:ss"),i=a.filter(e=>e.hora_inicio<=s&&e.hora_fin>s).map(e=>e.barbero_id);if(0===i.length)throw Error("Ning\xfan barbero cubre este horario.");let n=u.toISOString(),o=(0,c.Z)(u,r.duracion_minutos).toISOString(),{data:d}=await j.from("citas").select("barbero_id").in("barbero_id",i).gte("fecha_hora",n).lt("fecha_hora",o).neq("estado","cancelada"),x=new Set(d?.map(e=>e.barbero_id)||[]),m=i.filter(e=>!x.has(e));if(0===m.length)throw Error("Lo sentimos, el horario que elegiste ya no est\xe1 disponible.");e=m[Math.floor(Math.random()*m.length)]}catch(e){alert("Error de disponibilidad: "+e.message),p(!1);return}let t={barbero_id:e,servicio_id:r.id,fecha_hora:u.toISOString(),estado:"pendiente"};f?t.cliente_id=f.id:(t.cliente_nombre=g.nombre,t.cliente_telefono=g.telefono,t.cliente_email=g.email);let{error:a}=await j.from("citas").insert(t);a?(alert("Error al crear la cita: "+a.message),p(!1)):f?w.push("/dashboard?booking=success"):w.push("/?booking=success")};return(0,a.jsxs)("div",{className:"max-w-3xl mx-auto",children:[a.jsx("div",{className:"flex gap-2 mb-8",children:[1,2,3,4].map(t=>a.jsx("div",{className:(0,o.cn)("h-1.5 flex-1 rounded-full transition-all duration-500",e>=t?"bg-navy-900":"bg-zinc-200")},t))}),(0,a.jsxs)("div",{className:"min-h-[400px]",children:[1===e&&a.jsx(ServiceSelection,{selectedServiceId:r?.id,onSelect:e=>{d(e),t(2)}}),2===e&&(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("button",{onClick:()=>t(1),className:"text-sm font-medium text-navy-900/60 hover:text-navy-900 transition-colors flex items-center gap-2",children:"← Volver a servicios"}),a.jsx(BarberSelection,{selectedBarberId:x?.id,onSelect:e=>{m(e),t(3)}})]}),3===e&&r&&x&&(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("button",{onClick:()=>t(2),className:"text-sm font-medium text-navy-900/60 hover:text-navy-900 transition-colors flex items-center gap-2",children:"← Volver a barberos"}),a.jsx(DateTimePicker,{barberId:x.id,serviceDuration:r.duracion_minutos,selectedDate:u,onSelect:e=>{b(e),t(4)}})]}),4===e&&r&&x&&u&&(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("button",{onClick:()=>t(3),className:"text-sm font-medium text-navy-900/60 hover:text-navy-900 transition-colors flex items-center gap-2",children:"← Volver a horarios"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[a.jsx("div",{className:"order-2 md:order-1",children:!f&&a.jsx(GuestForm,{defaultValues:g,onChange:y})}),a.jsx("div",{className:"order-1 md:order-2",children:a.jsx(BookingSummary,{service:r,barber:x,date:u,onConfirm:handleConfirm,loading:h})})]})]})]})]})}},8699:(e,t,r)=>{"use strict";r.d(t,{cn:()=>cn});var a=r(566),s=r(8126);function cn(...e){return(0,s.m6)((0,a.W)(e))}},2120:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>BookPage,dynamic:()=>x});var a=r(4656),s=r(5153);let i=(0,s.createProxy)(String.raw`C:\Users\DAVID\OneDrive\Documentos\barber-platform\components\booking\BookingWizard.tsx`),{__esModule:n,$$typeof:o}=i,l=i.default;var c=r(4353),d=r.n(c);let x="force-dynamic";function BookPage(){return(0,a.jsxs)("main",{className:"min-h-screen bg-[#F2F2F2] text-navy-900 px-4 py-8 font-outfit",children:[a.jsx("div",{className:"max-w-4xl mx-auto mb-8 flex items-center justify-between",children:(0,a.jsxs)(d(),{href:"/",className:"flex items-center gap-2 group",children:[a.jsx("span",{className:"bg-navy-900 text-white w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold group-hover:scale-105 transition-transform",children:"T"}),a.jsx("span",{className:"font-bold tracking-tight text-xl text-navy-900",children:"TRIM APP"})]})}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[a.jsx("h1",{className:"text-4xl font-bold mb-2 tracking-tight text-navy-900",children:"Agendar Cita"}),a.jsx("p",{className:"text-zinc-500 text-lg",children:"Selecciona tu servicio y profesional preferido."})]}),a.jsx("div",{className:"bg-white rounded-[2rem] p-6 md:p-10 shadow-xl border border-white/50",children:a.jsx(l,{})})]})]})}}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[657,126,614,334,410,859,560,524,9],()=>__webpack_exec__(5505));module.exports=r})();