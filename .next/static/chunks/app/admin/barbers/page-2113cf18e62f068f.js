(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[596],{3828:function(e,a,r){Promise.resolve().then(r.bind(r,5794))},5794:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return AdminBarbersPage}});var i=r(7437),t=r(2265),n=r(3082),o=r(1628);let s=["Domingo","Lunes","Martes","Mi\xe9rcoles","Jueves","Viernes","S\xe1bado"];function AdminBarbersPage(){let[e,a]=(0,t.useState)([]),[r,l]=(0,t.useState)(!0),[d,c]=(0,t.useState)(""),[u,h]=(0,t.useState)(!1),[x,m]=(0,t.useState)(""),[f,b]=(0,t.useState)(null),[p,v]=(0,t.useState)([]),[g,y]=(0,t.useState)(!1),j=(0,n.createClientComponentClient)(),fetchBarbers=async()=>{l(!0);let{data:e}=await j.from("perfiles").select("*").eq("rol","barbero").order("nombre");e&&a(e),l(!1)},fetchSchedules=async e=>{let{data:a}=await j.from("horarios_disponibilidad").select("*").eq("barbero_id",e),r=Array.from({length:7}).map((e,r)=>{let i=null==a?void 0:a.find(e=>e.dia_semana===r);return i?{id:i.id,dia_semana:i.dia_semana,hora_inicio:i.hora_inicio,hora_fin:i.hora_fin,activo:i.activo}:{dia_semana:r,hora_inicio:"09:00",hora_fin:"18:00",activo:!1}});v(r)};(0,t.useEffect)(()=>{fetchBarbers()},[]);let handleEditSchedule=e=>{b(e),fetchSchedules(e.id)},handleSaveSchedule=async()=>{if(!f)return;y(!0);let e=p.map(e=>({barbero_id:f.id,dia_semana:e.dia_semana,hora_inicio:e.hora_inicio,hora_fin:e.hora_fin,activo:e.activo})),{error:a}=await j.from("horarios_disponibilidad").delete().eq("barbero_id",f.id);if(a)alert("Error preparando actualizaci\xf3n: "+a.message);else{let{error:a}=await j.from("horarios_disponibilidad").insert(e);a?alert("Error guardando: "+a.message):alert("\xa1Horarios actualizados exitosamente!")}y(!1)},handlePromote=async e=>{e.preventDefault(),h(!0),m("");let{data:a,error:r}=await j.from("perfiles").select("*").ilike("email",d.trim()).maybeSingle();if(r||!a){m("❌ Usuario no encontrado."),h(!1);return}let{error:i}=await j.from("perfiles").update({rol:"barbero"}).eq("id",a.id);i?m("❌ Error: ".concat(i.message)):(m("✅ \xa1Usuario promovido!"),c(""),fetchBarbers()),h(!1)},handleDemote=async e=>{confirm("\xbfQuitar rol de barbero a este usuario?")&&(await j.from("perfiles").update({rol:"cliente"}).eq("id",e),fetchBarbers())};return(0,i.jsxs)("div",{className:"space-y-8",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-navy-900",children:"Gesti\xf3n de Equipo"}),(0,i.jsxs)("div",{className:"grid lg:grid-cols-3 gap-8",children:[(0,i.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,i.jsxs)("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-zinc-100",children:[(0,i.jsx)("h2",{className:"font-bold text-navy-900 mb-4",children:"Agregar Nuevo Barbero"}),(0,i.jsxs)("form",{onSubmit:handlePromote,className:"space-y-3",children:[(0,i.jsx)("input",{type:"email",placeholder:"Email del usuario...",className:"w-full rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-navy-900/10 text-sm border border-zinc-200",style:{backgroundColor:"#ffffff",color:"#000000"},autoComplete:"off",value:d,onChange:e=>c(e.target.value)}),(0,i.jsx)("button",{disabled:u,className:"w-full bg-navy-900 text-white font-bold py-3 rounded-xl text-sm hover:bg-navy-800 transition-colors disabled:opacity-50",children:u?"Buscando...":"Promover Usuario"}),x&&(0,i.jsx)("p",{className:"text-xs font-medium text-center",children:x})]})]}),(0,i.jsx)("div",{className:"space-y-3",children:e.map(e=>{var a;return(0,i.jsxs)("div",{onClick:()=>handleEditSchedule(e),className:(0,o.cn)("p-4 rounded-xl border cursor-pointer transition-all flex items-center gap-3 hover:shadow-md",(null==f?void 0:f.id)===e.id?"bg-navy-900 border-navy-900 text-white":"bg-white border-zinc-200 text-navy-900 hover:border-navy-900/30"),children:[(0,i.jsx)("div",{className:(0,o.cn)("w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm",(null==f?void 0:f.id)===e.id?"bg-white/20 text-white":"bg-zinc-100 text-zinc-500"),children:null===(a=e.nombre)||void 0===a?void 0:a[0]}),(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsx)("h3",{className:"font-bold truncate",children:e.nombre}),(0,i.jsx)("p",{className:(0,o.cn)("text-xs truncate",(null==f?void 0:f.id)===e.id?"text-white/60":"text-zinc-400"),children:e.email})]}),(0,i.jsx)("span",{className:(0,o.cn)("text-xl",(null==f?void 0:f.id)===e.id?"opacity-100":"opacity-0 group-hover:opacity-100"),children:"\uD83D\uDC49"})]},e.id)})})]}),(0,i.jsx)("div",{className:"lg:col-span-2",children:f?(0,i.jsxs)("div",{className:"bg-white rounded-3xl shadow-xl border border-zinc-100 overflow-hidden",children:[(0,i.jsxs)("div",{className:"p-8 border-b border-zinc-100 flex justify-between items-center bg-zinc-50/50",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-2xl font-bold text-navy-900",children:"Configurar Horario"}),(0,i.jsxs)("p",{className:"text-zinc-500",children:["Editando disponibilidad de ",(0,i.jsx)("span",{className:"font-bold text-navy-900",children:f.nombre})]})]}),(0,i.jsx)("button",{onClick:()=>handleDemote(f.id),className:"text-red-500 text-sm font-medium hover:bg-red-50 px-3 py-1.5 rounded-lg transition-colors",children:"Eliminar rol"})]}),(0,i.jsx)("div",{className:"p-8 space-y-4",children:p.map((e,a)=>(0,i.jsxs)("div",{className:(0,o.cn)("flex items-center gap-4 p-4 rounded-xl transition-colors border",e.activo?"bg-white border-zinc-200":"bg-zinc-50 border-transparent opacity-60"),children:[(0,i.jsx)("div",{className:"w-32 font-medium text-navy-900",children:s[e.dia_semana]}),(0,i.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,i.jsx)("input",{type:"checkbox",className:"sr-only peer",checked:e.activo,onChange:e=>{let r=[...p];r[a].activo=e.target.checked,v(r)}}),(0,i.jsx)("div",{className:"w-11 h-6 bg-zinc-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-navy-900"})]}),e.activo&&(0,i.jsxs)("div",{className:"flex items-center gap-2 flex-1 justify-end animate-in fade-in duration-300",children:[(0,i.jsx)("input",{type:"time",value:e.hora_inicio,onChange:e=>{let r=[...p];r[a].hora_inicio=e.target.value,v(r)},className:"bg-zinc-50 border border-zinc-200 rounded-lg px-2 py-1 text-sm outline-none focus:border-navy-900"}),(0,i.jsx)("span",{className:"text-zinc-400",children:"-"}),(0,i.jsx)("input",{type:"time",value:e.hora_fin,onChange:e=>{let r=[...p];r[a].hora_fin=e.target.value,v(r)},className:"bg-zinc-50 border border-zinc-200 rounded-lg px-2 py-1 text-sm outline-none focus:border-navy-900"})]}),!e.activo&&(0,i.jsx)("div",{className:"flex-1 text-right text-xs text-zinc-400 font-medium uppercase tracking-wider",children:"No Laboral"})]},a))}),(0,i.jsxs)("div",{className:"p-6 bg-zinc-50 border-t border-zinc-100 flex justify-end gap-3 sticky bottom-0",children:[(0,i.jsx)("button",{onClick:()=>b(null),className:"px-6 py-3 text-zinc-500 font-bold hover:bg-zinc-100 rounded-xl transition-colors",children:"Cancelar"}),(0,i.jsx)("button",{onClick:handleSaveSchedule,disabled:g,className:"px-8 py-3 bg-navy-900 text-white font-bold rounded-xl shadow-lg hover:shadow-xl hover:-translate-y-0.5 transition-all disabled:opacity-50",children:g?"Guardando...":"Guardar Horario"})]})]}):(0,i.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-zinc-400 border-2 border-dashed border-zinc-200 rounded-3xl p-12 bg-zinc-50/50",children:[(0,i.jsx)("span",{className:"text-4xl mb-4",children:"\uD83D\uDC48"}),(0,i.jsx)("p",{className:"font-medium",children:"Selecciona un barbero para gestionar su horario"})]})})]})]})}},1628:function(e,a,r){"use strict";r.d(a,{cn:function(){return cn}});var i=r(7042),t=r(4769);function cn(){for(var e=arguments.length,a=Array(e),r=0;r<e;r++)a[r]=arguments[r];return(0,t.m6)((0,i.W)(a))}}},function(e){e.O(0,[311,82,985,971,472,744],function(){return e(e.s=3828)}),_N_E=e.O()}]);